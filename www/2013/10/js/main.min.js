var Main={};var container,camera,scene,renderer,directionalLight,pointLight,physics,mouseX=0,mouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,SHADOWS=false,PI2=Math.PI*2,R2D=180/Math.PI,D2R=Math.PI/180,PHI=3*D2R;var box;var boxes;var mouse_position=new THREE.Vector3();if(!Detector.webgl){Detector.addGetWebGLMessage()}else{init();animate()}function init(){Physijs.scripts.worker="./js/physi/physijs_worker.js";Physijs.scripts.ammo="./ammo.js";projector=new THREE.Projector();container=document.createElement("div");document.body.appendChild(container);camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,5000);camera.position.z=50;scene=new Physijs.Scene;scene.setGravity(new THREE.Vector3(0,-98.2,0));renderer=new THREE.WebGLRenderer({antialias:true});renderer.setClearColor(16777215,1);renderer.setSize(window.innerWidth,window.innerHeight);renderer.autoClear=false;renderer.shadowMapEnabled=true;renderer.shadowMapSoft=true;container.appendChild(renderer.domElement);window.addEventListener("resize",onWindowResize,false);document.addEventListener("mousedown",onDocumentMouseDown,false);document.addEventListener("mousemove",onDocumentMouseMove,false);var n=new THREE.AmbientLight(0);scene.add(n);var m=3;var a=Math.PI*2/m;for(var b=0;b<3;b++){pointLight=new THREE.PointLight(16777215,1.5);pointLight.position.x=Math.cos(b*a)*1000;pointLight.position.y=1000;pointLight.position.z=Math.sin(b*a)*10000;scene.add(pointLight)}var o=new Materials();var g=Physijs.createMaterial(new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture("./img/bg.png")}),0.8,0.4);g.map.wrapS=g.map.wrapT=THREE.RepeatWrapping;g.map.repeat.set(256,256);var f=new Physijs.BoxMesh(new THREE.CubeGeometry(100,1,100),g,0);f.scale.set(10,1,10);scene.add(f);var k=Physijs.createMaterial(Materials.cubeMaterial3,0.8,0.2);boxes=[];for(var b=0;b<10;b++){box=new Physijs.BoxMesh(new THREE.CubeGeometry(5,5,5),k);box.mass=500;box.position.set(-50+b*10,15,0);var p=1;box.scale.set(Math.random()*1+0.5,Math.random()*1+0.5,Math.random()*1+0.5);box.mass=p*100;scene.add(box);boxes.push(box)}var l=new Physijs.CylinderMesh(new THREE.CylinderGeometry(10,10,3),k,5000);l.position.set(0,1.5,0);scene.add(l);boxes.push(l);box=new Physijs.BoxMesh(new THREE.CubeGeometry(25,2,10),k);var p=new Satellite(box);box.position.set(10,4,0);scene.add(box);boxes.push(box);var e=new Physijs.SphereMesh(new THREE.SphereGeometry(5),k,500);e.position.set(5,10,0);scene.add(e);boxes.push(e);var j=new Physijs.DOFConstraint(l,box,new THREE.Vector3(5,2,0));scene.addConstraint(j);var d=new Physijs.HingeConstraint(e,box,new THREE.Vector3(10,4,2),new THREE.Vector3(1,0,0));scene.addConstraint(d);createScene(new THREE.TorusGeometry(25,5,64,32))}function onWindowResize(){windowHalfX=window.innerWidth/2;windowHalfY=window.innerHeight/2;camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight)}function createScene(b){var a=1;var c=new THREE.Mesh(b,Materials.cubeMaterial1);c.position.z=-100;c.scale.x=c.scale.y=c.scale.z=a;scene.add(c);var c=new THREE.Mesh(b,Materials.cubeMaterial2);c.position.x=-100;c.position.z=-100;c.scale.x=c.scale.y=c.scale.z=a;scene.add(c);var c=new THREE.Mesh(b,Materials.cubeMaterial3);c.position.x=100;c.position.z=-100;c.scale.x=c.scale.y=c.scale.z=a;scene.add(c)}function onDocumentMouseDown(a){mouseDown=false}function onDocumentMouseDown(a){mouseDown=false}function onDocumentMouseMove(a){mouseX=(a.clientX-windowHalfX)*4;mouseY=(a.clientY-windowHalfY)*4;getWorldMousePosition(a)}function animate(){scene.simulate(undefined,1);Satellite.update();render();requestAnimationFrame(animate)}function render(){var b=-0.002*Date.now();camera.position.x+=((mouseX/20)-camera.position.x)*0.05;camera.position.y=15;camera.position.z=100;var a=new THREE.Vector3(0,10,0);camera.lookAt(a);renderer.clear();renderer.render(scene,camera)}function getWorldMousePosition(b){var a=new THREE.Vector3((b.clientX/renderer.domElement.clientWidth)*2-1,-((b.clientY/renderer.domElement.clientHeight)*2-1),0.5);projector.unprojectVector(a,camera);a.sub(camera.position).normalize();var c=-camera.position.y/a.y;mouse_position=camera.position.clone().add(a.multiplyScalar(c));applyForce()}function applyForce(){boxes.forEach(function(g){g.setAngularVelocity(new THREE.Vector3(0,10,0))});if(!mouse_position){return}var e=20000,f,b,d,c;for(var a=0;a<boxes.length;a++){c=boxes[a];f=mouse_position.distanceTo(c.position),b=mouse_position.clone().sub(c.position).normalize().multiplyScalar(e/f),d=mouse_position.clone().sub(c.position);c.applyImpulse(b,d)}};