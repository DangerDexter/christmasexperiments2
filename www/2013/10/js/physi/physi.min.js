window.Physijs=(function(){var d,u=false,a=j,j={},s,t,h,o,b,g,k,i,r=new THREE.Vector3,q=new THREE.Vector3,f=new THREE.Matrix4,n=new THREE.Quaternion,p={WORLDREPORT:0,COLLISIONREPORT:1,VEHICLEREPORT:2,CONSTRAINTREPORT:3},l=14,m=5,c=9,e=6;j.scripts={};s=function(){this._eventListeners={}};s.prototype.addEventListener=function(v,w){if(!this._eventListeners.hasOwnProperty(v)){this._eventListeners[v]=[]}this._eventListeners[v].push(w)};s.prototype.removeEventListener=function(w,x){var v;if(!this._eventListeners.hasOwnProperty(w)){return false}if((v=this._eventListeners[w].indexOf(x))>=0){this._eventListeners[w].splice(v,1);return true}return false};s.prototype.dispatchEvent=function(x){var v,w=Array.prototype.splice.call(arguments,1);if(this._eventListeners.hasOwnProperty(x)){for(v=0;v<this._eventListeners[x].length;v++){this._eventListeners[x][v].apply(this,w)}}};s.make=function(v){v.prototype.addEventListener=s.prototype.addEventListener;v.prototype.removeEventListener=s.prototype.removeEventListener;v.prototype.dispatchEvent=s.prototype.dispatchEvent};t=(function(){var v=1;return function(){return v++}})();h=function(v,C,B,A){return new THREE.Vector3(Math.atan2(2*(v*A-C*B),(A*A-v*v-C*C+B*B)),Math.asin(2*(v*B+C*A)),Math.atan2(2*(B*A-v*C),(A*A+v*v-C*C-B*B)))};o=function(G,E,D){var B,I,A,H,w,F,v,C;B=Math.cos(E);I=Math.sin(E);A=Math.cos(-D);H=Math.sin(-D);w=Math.cos(G);F=Math.sin(G);v=B*A;C=I*H;return{w:v*w-C*F,x:v*F+C*w,y:I*A*w+B*H*F,z:B*H*w-I*A*F}};b=function(v,w){f.identity();f.identity().makeRotationFromQuaternion(w.quaternion);f.getInverse(f);r.copy(v);q.copy(w.position);return r.sub(q).applyMatrix4(f)};j.noConflict=function(){window.Physijs=a;return j};j.createMaterial=function(v,y,x){var w=function(){};w.prototype=v;w=new w;w._physijs={id:v.id,friction:y===undefined?0.8:y,restitution:x===undefined?0.2:x};return w};j.PointConstraint=function(x,w,v){if(v===undefined){v=w;w=undefined}this.type="point";this.appliedImpulse=0;this.id=t();this.objecta=x._physijs.id;this.positiona=b(v,x).clone();if(w){this.objectb=w._physijs.id;this.positionb=b(v,w).clone()}};j.PointConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb}};j.HingeConstraint=function(x,w,v,y){if(y===undefined){y=v;v=w;w=undefined}this.type="hinge";this.appliedImpulse=0;this.id=t();this.scene=x.parent;this.objecta=x._physijs.id;this.positiona=b(v,x).clone();this.position=v.clone();this.axis=y;if(w){this.objectb=w._physijs.id;this.positionb=b(v,w).clone()}};j.HingeConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}};j.HingeConstraint.prototype.setLimits=function(v,x,w,y){this.scene.execute("hinge_setLimits",{constraint:this.id,low:v,high:x,bias_factor:w,relaxation_factor:y})};j.HingeConstraint.prototype.enableAngularMotor=function(w,v){this.scene.execute("hinge_enableAngularMotor",{constraint:this.id,velocity:w,acceleration:v})};j.HingeConstraint.prototype.disableMotor=function(w,v){this.scene.execute("hinge_disableMotor",{constraint:this.id})};j.SliderConstraint=function(x,w,v,y){if(y===undefined){y=v;v=w;w=undefined}this.type="slider";this.appliedImpulse=0;this.id=t();this.scene=x.parent;this.objecta=x._physijs.id;this.positiona=b(v,x).clone();this.axis=y;if(w){this.objectb=w._physijs.id;this.positionb=b(v,w).clone()}};j.SliderConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}};j.SliderConstraint.prototype.setLimits=function(y,v,w,x){this.scene.execute("slider_setLimits",{constraint:this.id,lin_lower:y,lin_upper:v,ang_lower:w,ang_upper:x})};j.SliderConstraint.prototype.setRestitution=function(v,w){this.scene.execute("slider_setRestitution",{constraint:this.id,linear:v,angular:w})};j.SliderConstraint.prototype.enableLinearMotor=function(w,v){this.scene.execute("slider_enableLinearMotor",{constraint:this.id,velocity:w,acceleration:v})};j.SliderConstraint.prototype.disableLinearMotor=function(){this.scene.execute("slider_disableLinearMotor",{constraint:this.id})};j.SliderConstraint.prototype.enableAngularMotor=function(w,v){this.scene.execute("slider_enableAngularMotor",{constraint:this.id,velocity:w,acceleration:v})};j.SliderConstraint.prototype.disableAngularMotor=function(){this.scene.execute("slider_disableAngularMotor",{constraint:this.id})};j.ConeTwistConstraint=function(x,w,v){if(v===undefined){throw"Both objects must be defined in a ConeTwistConstraint."}this.type="conetwist";this.appliedImpulse=0;this.id=t();this.scene=x.parent;this.objecta=x._physijs.id;this.positiona=b(v,x).clone();this.objectb=w._physijs.id;this.positionb=b(v,w).clone();this.axisa={x:x.rotation.x,y:x.rotation.y,z:x.rotation.z};this.axisb={x:w.rotation.x,y:w.rotation.y,z:w.rotation.z}};j.ConeTwistConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}};j.ConeTwistConstraint.prototype.setLimit=function(v,A,w){this.scene.execute("conetwist_setLimit",{constraint:this.id,x:v,y:A,z:w})};j.ConeTwistConstraint.prototype.enableMotor=function(){this.scene.execute("conetwist_enableMotor",{constraint:this.id})};j.ConeTwistConstraint.prototype.setMaxMotorImpulse=function(v){this.scene.execute("conetwist_setMaxMotorImpulse",{constraint:this.id,max_impulse:v})};j.ConeTwistConstraint.prototype.setMotorTarget=function(v){if(v instanceof THREE.Vector3){v=new THREE.Quaternion().setFromEuler(new THREE.Euler(v.x,v.y,v.z))}else{if(v instanceof THREE.Euler){v=new THREE.Quaternion().setFromEuler(v)}else{if(v instanceof THREE.Matrix4){v=new THREE.Quaternion().setFromRotationMatrix(v)}}}this.scene.execute("conetwist_setMotorTarget",{constraint:this.id,x:v.x,y:v.y,z:v.z,w:v.w})};j.ConeTwistConstraint.prototype.disableMotor=function(){this.scene.execute("conetwist_disableMotor",{constraint:this.id})};j.DOFConstraint=function(x,w,v){if(v===undefined){v=w;w=undefined}this.type="dof";this.appliedImpulse=0;this.id=t();this.scene=x.parent;this.objecta=x._physijs.id;this.positiona=b(v,x).clone();this.axisa={x:x.rotation.x,y:x.rotation.y,z:x.rotation.z};if(w){this.objectb=w._physijs.id;this.positionb=b(v,w).clone();this.axisb={x:w.rotation.x,y:w.rotation.y,z:w.rotation.z}}};j.DOFConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}};j.DOFConstraint.prototype.setLinearLowerLimit=function(v){this.scene.execute("dof_setLinearLowerLimit",{constraint:this.id,x:v.x,y:v.y,z:v.z})};j.DOFConstraint.prototype.setLinearUpperLimit=function(v){this.scene.execute("dof_setLinearUpperLimit",{constraint:this.id,x:v.x,y:v.y,z:v.z})};j.DOFConstraint.prototype.setAngularLowerLimit=function(v){this.scene.execute("dof_setAngularLowerLimit",{constraint:this.id,x:v.x,y:v.y,z:v.z})};j.DOFConstraint.prototype.setAngularUpperLimit=function(v){this.scene.execute("dof_setAngularUpperLimit",{constraint:this.id,x:v.x,y:v.y,z:v.z})};j.DOFConstraint.prototype.enableAngularMotor=function(v){this.scene.execute("dof_enableAngularMotor",{constraint:this.id,which:v})};j.DOFConstraint.prototype.configureAngularMotor=function(z,v,x,w,y){this.scene.execute("dof_configureAngularMotor",{constraint:this.id,which:z,low_angle:v,high_angle:x,velocity:w,max_force:y})};j.DOFConstraint.prototype.disableAngularMotor=function(v){this.scene.execute("dof_disableAngularMotor",{constraint:this.id,which:v})};j.Scene=function(x){var v=this;s.call(this);THREE.Scene.call(this);this._worker=new Worker(j.scripts.worker||"physijs_worker.js");this._worker.transferableMessage=this._worker.webkitPostMessage||this._worker.postMessage;this._materials_ref_counts={};this._objects={};this._vehicles={};this._constraints={};var w=new ArrayBuffer(1);this._worker.transferableMessage(w,[w]);d=(w.byteLength===0);this._worker.onmessage=function(z){var y,A=z.data;if(A instanceof ArrayBuffer&&A.byteLength!==1){A=new Float32Array(A)}if(A instanceof Float32Array){switch(A[0]){case p.WORLDREPORT:v._updateScene(A);break;case p.COLLISIONREPORT:v._updateCollisions(A);break;case p.VEHICLEREPORT:v._updateVehicles(A);break;case p.CONSTRAINTREPORT:v._updateConstraints(A);break}}else{if(A.cmd){switch(A.cmd){case"objectReady":y=A.params;if(v._objects[y]){v._objects[y].dispatchEvent("ready")}break;case"worldReady":v.dispatchEvent("ready");break;case"vehicle":window.test=A;break;default:console.debug("Received: "+A.cmd);console.dir(A.params);break}}else{switch(A[0]){case p.WORLDREPORT:v._updateScene(A);break;case p.COLLISIONREPORT:v._updateCollisions(A);break;case p.VEHICLEREPORT:v._updateVehicles(A);break;case p.CONSTRAINTREPORT:v._updateConstraints(A);break}}}};x=x||{};x.ammo=j.scripts.ammo||"ammo.js";x.fixedTimeStep=x.fixedTimeStep||1/60;x.rateLimit=x.rateLimit||true;this.execute("init",x)};j.Scene.prototype=new THREE.Scene;j.Scene.prototype.constructor=j.Scene;s.make(j.Scene);j.Scene.prototype._updateScene=function(y){var x=y[1],v,w,z;for(w=0;w<x;w++){z=2+w*l;v=this._objects[y[z]];if(v===undefined){continue}if(v.__dirtyPosition===false){v.position.set(y[z+1],y[z+2],y[z+3])}if(v.__dirtyRotation===false){v.quaternion.set(y[z+4],y[z+5],y[z+6],y[z+7])}v._physijs.linearVelocity.set(y[z+8],y[z+9],y[z+10]);v._physijs.angularVelocity.set(y[z+11],y[z+12],y[z+13])}if(d){this._worker.transferableMessage(y.buffer,[y.buffer])}u=false;this.dispatchEvent("update")};j.Scene.prototype._updateVehicles=function(x){var z,v,w,y;for(w=0;w<(x.length-1)/c;w++){y=1+w*c;z=this._vehicles[x[y]];if(z===undefined){continue}v=z.wheels[x[y+1]];v.position.set(x[y+2],x[y+3],x[y+4]);v.quaternion.set(x[y+5],x[y+6],x[y+7],x[y+8])}if(d){this._worker.transferableMessage(x.buffer,[x.buffer])}};j.Scene.prototype._updateConstraints=function(x){var y,v,w,z;for(w=0;w<(x.length-1)/e;w++){z=1+w*e;y=this._constraints[x[z]];v=this._objects[x[z+1]];if(y===undefined||v===undefined){continue}r.set(x[z+2],x[z+3],x[z+4]);f.extractRotation(v.matrix);r.applyMatrix4(f);y.positiona.addVectors(v.position,r);y.appliedImpulse=x[z+5]}if(d){this._worker.transferableMessage(x.buffer,[x.buffer])}};j.Scene.prototype._updateCollisions=function(z){var A,y,x,w,F,C={},E=[],D={};for(A=0;A<z[1];A++){x=2+A*m;w=z[x];F=z[x+1];D[w+"-"+F]=x+2;D[F+"-"+w]=-1*(x+2);if(!C[w]){C[w]=[]}C[w].push(F)}for(w in this._objects){if(!this._objects.hasOwnProperty(w)){return}w=this._objects[w];if(C[w._physijs.id]){E.length=0;for(y=0;y<C[w._physijs.id].length;y++){F=this._objects[C[w._physijs.id][y]];if(F){if(w._physijs.touches.indexOf(F._physijs.id)===-1){w._physijs.touches.push(F._physijs.id);r.subVectors(w.getLinearVelocity(),F.getLinearVelocity());k=r.clone();r.subVectors(w.getAngularVelocity(),F.getAngularVelocity());i=r.clone();var B=D[w._physijs.id+"-"+F._physijs.id];if(B>0){r.set(-z[B],-z[B+1],-z[B+2])}else{B*=-1;r.set(z[B],z[B+1],z[B+2])}w.dispatchEvent("collision",F,k,i,r);F.dispatchEvent("collision",w,k,i,r.negate())}E.push(F._physijs.id)}}for(y=0;y<w._physijs.touches.length;y++){if(E.indexOf(w._physijs.touches[y])===-1){w._physijs.touches.splice(y--,1)}}}else{w._physijs.touches.length=0}}for(var v in C){if(C.hasOwnProperty(v)&&C[v]){for(y=0;y<C[v].length;y++){if(C[v][y]){C[C[v][y]]=C[C[v][y]]||[];C[C[v][y]].push(v)}}}}this.collisions=C;if(d){this._worker.transferableMessage(z.buffer,[z.buffer])}};j.Scene.prototype.addConstraint=function(x,w){this._constraints[x.id]=x;this.execute("addConstraint",x.getDefinition());if(w){var v;switch(x.type){case"point":v=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial);v.position.copy(x.positiona);this._objects[x.objecta].add(v);break;case"hinge":v=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial);v.position.copy(x.positiona);this._objects[x.objecta].add(v);break;case"slider":v=new THREE.Mesh(new THREE.CubeGeometry(10,1,1),new THREE.MeshNormalMaterial);v.position.copy(x.positiona);v.rotation.set(x.axis.y,x.axis.x,x.axis.z);this._objects[x.objecta].add(v);break;case"conetwist":v=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial);v.position.copy(x.positiona);this._objects[x.objecta].add(v);break;case"dof":v=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial);v.position.copy(x.positiona);this._objects[x.objecta].add(v);break}}return x};j.Scene.prototype.removeConstraint=function(v){if(this._constraints[v.id]!==undefined){this.execute("removeConstraint",{id:v.id});delete this._constraints[v.id]}};j.Scene.prototype.execute=function(v,w){this._worker.postMessage({cmd:v,params:w})};g=function(x,v){var w;for(w=0;w<v.children.length;w++){if(v.children[w]._physijs){v.children[w].updateMatrix();v.children[w].updateMatrixWorld();r.getPositionFromMatrix(v.children[w].matrixWorld);n.setFromRotationMatrix(v.children[w].matrixWorld);v.children[w]._physijs.position_offset={x:r.x,y:r.y,z:r.z};v.children[w]._physijs.rotation={x:n.x,y:n.y,z:n.z,w:n.w};x._physijs.children.push(v.children[w]._physijs)}g(x,v.children[w])}};j.Scene.prototype.add=function(v){THREE.Mesh.prototype.add.call(this,v);if(v._physijs){v.world=this;if(v instanceof j.Vehicle){this.add(v.mesh);this._vehicles[v._physijs.id]=v;this.execute("addVehicle",v._physijs)}else{v.__dirtyPosition=false;v.__dirtyRotation=false;this._objects[v._physijs.id]=v;if(v.children.length){v._physijs.children=[];g(v,v)}if(v.material._physijs){if(!this._materials_ref_counts.hasOwnProperty(v.material._physijs.id)){this.execute("registerMaterial",v.material._physijs);v._physijs.materialId=v.material._physijs.id;this._materials_ref_counts[v.material._physijs.id]=1}else{this._materials_ref_counts[v.material._physijs.id]++}}v._physijs.position={x:v.position.x,y:v.position.y,z:v.position.z};v._physijs.rotation={x:v.quaternion.x,y:v.quaternion.y,z:v.quaternion.z,w:v.quaternion.w};var w=new THREE.Vector3(1,1,1);if(v._physijs.width){v._physijs.width*=v.scale.x}if(v._physijs.height){v._physijs.height*=v.scale.y}if(v._physijs.depth){v._physijs.depth*=v.scale.z}this.execute("addObject",v._physijs)}}};j.Scene.prototype.remove=function(v){if(v instanceof j.Vehicle){this.execute("removeVehicle",{id:v._physijs.id});while(v.wheels.length){this.remove(v.wheels.pop())}this.remove(v.mesh);delete this._vehicles[v._physijs.id]}else{THREE.Mesh.prototype.remove.call(this,v);if(v._physijs){delete this._objects[v._physijs.id];this.execute("removeObject",{id:v._physijs.id})}}if(v.material&&v.material._physijs&&this._materials_ref_counts.hasOwnProperty(v.material._physijs.id)){this._materials_ref_counts[v.material._physijs.id]--;if(this._materials_ref_counts[v.material._physijs.id]==0){this.execute("unRegisterMaterial",v.material._physijs);delete this._materials_ref_counts[v.material._physijs.id]}}};j.Scene.prototype.setFixedTimeStep=function(v){if(v){this.execute("setFixedTimeStep",v)}};j.Scene.prototype.setGravity=function(v){if(v){this.execute("setGravity",v)}};j.Scene.prototype.simulate=function(x,y){var w,v,z;if(u){return false}u=true;for(w in this._objects){if(!this._objects.hasOwnProperty(w)){continue}v=this._objects[w];if(v.__dirtyPosition||v.__dirtyRotation){z={id:v._physijs.id};if(v.__dirtyPosition){z.pos={x:v.position.x,y:v.position.y,z:v.position.z};v.__dirtyPosition=false}if(v.__dirtyRotation){z.quat={x:v.quaternion.x,y:v.quaternion.y,z:v.quaternion.z,w:v.quaternion.w};v.__dirtyRotation=false}this.execute("updateTransform",z)}}this.execute("simulate",{timeStep:x,maxSubSteps:y});return true};j.Mesh=function(y,x,w){var v;if(!y){return}s.call(this);THREE.Mesh.call(this,y,x);if(!y.boundingBox){y.computeBoundingBox()}this._physijs={type:null,id:t(),mass:w||0,touches:[],linearVelocity:new THREE.Vector3,angularVelocity:new THREE.Vector3}};j.Mesh.prototype=new THREE.Mesh;j.Mesh.prototype.constructor=j.Mesh;s.make(j.Mesh);j.Mesh.prototype.__defineGetter__("mass",function(){return this._physijs.mass});j.Mesh.prototype.__defineSetter__("mass",function(v){this._physijs.mass=v;if(this.world){this.world.execute("updateMass",{id:this._physijs.id,mass:v})}});j.Mesh.prototype.applyCentralImpulse=function(v){if(this.world){this.world.execute("applyCentralImpulse",{id:this._physijs.id,x:v.x,y:v.y,z:v.z})}};j.Mesh.prototype.applyImpulse=function(v,w){if(this.world){this.world.execute("applyImpulse",{id:this._physijs.id,impulse_x:v.x,impulse_y:v.y,impulse_z:v.z,x:w.x,y:w.y,z:w.z})}};j.Mesh.prototype.applyCentralForce=function(v){if(this.world){this.world.execute("applyCentralForce",{id:this._physijs.id,x:v.x,y:v.y,z:v.z})}};j.Mesh.prototype.applyForce=function(v,w){if(this.world){this.world.execute("applyForce",{id:this._physijs.id,force_x:v.x,force_y:v.y,force_z:v.z,x:w.x,y:w.y,z:w.z})}};j.Mesh.prototype.getAngularVelocity=function(){return this._physijs.angularVelocity};j.Mesh.prototype.setAngularVelocity=function(v){if(this.world){this.world.execute("setAngularVelocity",{id:this._physijs.id,x:v.x,y:v.y,z:v.z})}};j.Mesh.prototype.getLinearVelocity=function(){return this._physijs.linearVelocity};j.Mesh.prototype.setLinearVelocity=function(v){if(this.world){this.world.execute("setLinearVelocity",{id:this._physijs.id,x:v.x,y:v.y,z:v.z})}};j.Mesh.prototype.setAngularFactor=function(v){if(this.world){this.world.execute("setAngularFactor",{id:this._physijs.id,x:v.x,y:v.y,z:v.z})}};j.Mesh.prototype.setLinearFactor=function(v){if(this.world){this.world.execute("setLinearFactor",{id:this._physijs.id,x:v.x,y:v.y,z:v.z})}};j.Mesh.prototype.setDamping=function(v,w){if(this.world){this.world.execute("setDamping",{id:this._physijs.id,linear:v,angular:w})}};j.Mesh.prototype.setCcdMotionThreshold=function(v){if(this.world){this.world.execute("setCcdMotionThreshold",{id:this._physijs.id,threshold:v})}};j.Mesh.prototype.setCcdSweptSphereRadius=function(v){if(this.world){this.world.execute("setCcdSweptSphereRadius",{id:this._physijs.id,radius:v})}};j.PlaneMesh=function(z,y,w){var x,v;j.Mesh.call(this,z,y,w);if(!z.boundingBox){z.computeBoundingBox()}x=z.boundingBox.max.x-z.boundingBox.min.x;v=z.boundingBox.max.y-z.boundingBox.min.y;this._physijs.type="plane";this._physijs.normal=z.faces[0].normal.clone();this._physijs.mass=(typeof w==="undefined")?x*v:w};j.PlaneMesh.prototype=new j.Mesh;j.PlaneMesh.prototype.constructor=j.PlaneMesh;j.HeightfieldMesh=function(z,x,y,B,w){j.Mesh.call(this,z,x,y);this._physijs.type="heightfield";this._physijs.xsize=z.boundingBox.max.x-z.boundingBox.min.x;this._physijs.ysize=z.boundingBox.max.y-z.boundingBox.min.y;this._physijs.xpts=(typeof B==="undefined")?Math.sqrt(z.vertices.length):B+1;this._physijs.ypts=(typeof w==="undefined")?Math.sqrt(z.vertices.length):w+1;this._physijs.absMaxHeight=Math.max(z.boundingBox.max.z,Math.abs(z.boundingBox.min.z));var D=[];var C,A;for(var v=0;v<z.vertices.length;v++){C=v%this._physijs.xpts;A=Math.round((v/this._physijs.xpts)-((v%this._physijs.xpts)/this._physijs.xpts));D[v]=z.vertices[C+((this._physijs.ypts-A-1)*this._physijs.ypts)].z}this._physijs.points=D};j.HeightfieldMesh.prototype=new j.Mesh;j.HeightfieldMesh.prototype.constructor=j.HeightfieldMesh;j.BoxMesh=function(A,y,w){var x,v,z;j.Mesh.call(this,A,y,w);if(!A.boundingBox){A.computeBoundingBox()}x=A.boundingBox.max.x-A.boundingBox.min.x;v=A.boundingBox.max.y-A.boundingBox.min.y;z=A.boundingBox.max.z-A.boundingBox.min.z;this._physijs.type="box";this._physijs.width=x;this._physijs.height=v;this._physijs.depth=z;this._physijs.mass=(typeof w==="undefined")?x*v*z:w};j.BoxMesh.prototype=new j.Mesh;j.BoxMesh.prototype.constructor=j.BoxMesh;j.SphereMesh=function(x,w,v){j.Mesh.call(this,x,w,v);if(!x.boundingSphere){x.computeBoundingSphere()}this._physijs.type="sphere";this._physijs.radius=x.boundingSphere.radius;this._physijs.mass=(typeof v==="undefined")?(4/3)*Math.PI*Math.pow(this._physijs.radius,3):v};j.SphereMesh.prototype=new j.Mesh;j.SphereMesh.prototype.constructor=j.SphereMesh;j.CylinderMesh=function(A,y,w){var x,v,z;j.Mesh.call(this,A,y,w);if(!A.boundingBox){A.computeBoundingBox()}x=A.boundingBox.max.x-A.boundingBox.min.x;v=A.boundingBox.max.y-A.boundingBox.min.y;z=A.boundingBox.max.z-A.boundingBox.min.z;this._physijs.type="cylinder";this._physijs.width=x;this._physijs.height=v;this._physijs.depth=z;this._physijs.mass=(typeof w==="undefined")?x*v*z:w};j.CylinderMesh.prototype=new j.Mesh;j.CylinderMesh.prototype.constructor=j.CylinderMesh;j.CapsuleMesh=function(A,y,w){var x,v,z;j.Mesh.call(this,A,y,w);if(!A.boundingBox){A.computeBoundingBox()}x=A.boundingBox.max.x-A.boundingBox.min.x;v=A.boundingBox.max.y-A.boundingBox.min.y;z=A.boundingBox.max.z-A.boundingBox.min.z;this._physijs.type="capsule";this._physijs.radius=Math.max(x/2,z/2);this._physijs.height=v;this._physijs.mass=(typeof w==="undefined")?x*v*z:w};j.CapsuleMesh.prototype=new j.Mesh;j.CapsuleMesh.prototype.constructor=j.CapsuleMesh;j.ConeMesh=function(A,y,w){var x,v,z;j.Mesh.call(this,A,y,w);if(!A.boundingBox){A.computeBoundingBox()}x=A.boundingBox.max.x-A.boundingBox.min.x;v=A.boundingBox.max.y-A.boundingBox.min.y;this._physijs.type="cone";this._physijs.radius=x/2;this._physijs.height=v;this._physijs.mass=(typeof w==="undefined")?x*v:w};j.ConeMesh.prototype=new j.Mesh;j.ConeMesh.prototype.constructor=j.ConeMesh;j.ConcaveMesh=function(D,z,C){var y,v,E,x,A,B,w=[];j.Mesh.call(this,D,z,C);if(!D.boundingBox){D.computeBoundingBox()}A=D.vertices;for(y=0;y<D.faces.length;y++){B=D.faces[y];if(B instanceof THREE.Face3){w.push([{x:A[B.a].x,y:A[B.a].y,z:A[B.a].z},{x:A[B.b].x,y:A[B.b].y,z:A[B.b].z},{x:A[B.c].x,y:A[B.c].y,z:A[B.c].z}])}else{if(B instanceof THREE.Face4){w.push([{x:A[B.a].x,y:A[B.a].y,z:A[B.a].z},{x:A[B.b].x,y:A[B.b].y,z:A[B.b].z},{x:A[B.d].x,y:A[B.d].y,z:A[B.d].z}]);w.push([{x:A[B.b].x,y:A[B.b].y,z:A[B.b].z},{x:A[B.c].x,y:A[B.c].y,z:A[B.c].z},{x:A[B.d].x,y:A[B.d].y,z:A[B.d].z}])}}}v=D.boundingBox.max.x-D.boundingBox.min.x;E=D.boundingBox.max.y-D.boundingBox.min.y;x=D.boundingBox.max.z-D.boundingBox.min.z;this._physijs.type="concave";this._physijs.triangles=w;this._physijs.mass=(typeof C==="undefined")?v*E*x:C};j.ConcaveMesh.prototype=new j.Mesh;j.ConcaveMesh.prototype.constructor=j.ConcaveMesh;j.ConvexMesh=function(C,A,x){var w,z,v,B,y=[];j.Mesh.call(this,C,A,x);if(!C.boundingBox){C.computeBoundingBox()}for(w=0;w<C.vertices.length;w++){y.push({x:C.vertices[w].x,y:C.vertices[w].y,z:C.vertices[w].z})}z=C.boundingBox.max.x-C.boundingBox.min.x;v=C.boundingBox.max.y-C.boundingBox.min.y;B=C.boundingBox.max.z-C.boundingBox.min.z;this._physijs.type="convex";this._physijs.points=y;this._physijs.mass=(typeof x==="undefined")?z*v*B:x};j.ConvexMesh.prototype=new j.Mesh;j.ConvexMesh.prototype.constructor=j.ConvexMesh;j.Vehicle=function(w,v){v=v||new j.VehicleTuning;this.mesh=w;this.wheels=[];this._physijs={id:t(),rigidBody:w._physijs.id,suspension_stiffness:v.suspension_stiffness,suspension_compression:v.suspension_compression,suspension_damping:v.suspension_damping,max_suspension_travel:v.max_suspension_travel,friction_slip:v.friction_slip,max_suspension_force:v.max_suspension_force}};j.Vehicle.prototype.addWheel=function(x,D,B,v,y,z,w,E,C){var A=new THREE.Mesh(x,D);A.castShadow=A.receiveShadow=true;A.position.copy(v).multiplyScalar(z/100).add(B);this.world.add(A);this.wheels.push(A);this.world.execute("addWheel",{id:this._physijs.id,connection_point:{x:B.x,y:B.y,z:B.z},wheel_direction:{x:v.x,y:v.y,z:v.z},wheel_axle:{x:y.x,y:y.y,z:y.z},suspension_rest_length:z,wheel_radius:w,is_front_wheel:E,tuning:C})};j.Vehicle.prototype.setSteering=function(x,v){if(v!==undefined&&this.wheels[v]!==undefined){this.world.execute("setSteering",{id:this._physijs.id,wheel:v,steering:x})}else{if(this.wheels.length>0){for(var w=0;w<this.wheels.length;w++){this.world.execute("setSteering",{id:this._physijs.id,wheel:w,steering:x})}}}};j.Vehicle.prototype.setBrake=function(x,v){if(v!==undefined&&this.wheels[v]!==undefined){this.world.execute("setBrake",{id:this._physijs.id,wheel:v,brake:x})}else{if(this.wheels.length>0){for(var w=0;w<this.wheels.length;w++){this.world.execute("setBrake",{id:this._physijs.id,wheel:w,brake:x})}}}};j.Vehicle.prototype.applyEngineForce=function(x,v){if(v!==undefined&&this.wheels[v]!==undefined){this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:v,force:x})}else{if(this.wheels.length>0){for(var w=0;w<this.wheels.length;w++){this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:w,force:x})}}}};j.VehicleTuning=function(z,x,A,w,v,y){this.suspension_stiffness=z!==undefined?z:5.88;this.suspension_compression=x!==undefined?x:0.83;this.suspension_damping=A!==undefined?A:0.88;this.max_suspension_travel=w!==undefined?w:500;this.friction_slip=v!==undefined?v:10.5;this.max_suspension_force=y!==undefined?y:6000};return j})();