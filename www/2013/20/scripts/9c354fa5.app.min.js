/* Made by Justin Windle - http://soulwire.co.uk */!function(){function a(a,b,c){for(var d in b)!c&&d in a&&"undefined"!=typeof a[d]||(a[d]=b[d]);return a}function b(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d}var c,d=function(){"use strict";function a(a){return"[object Array]"==Object.prototype.toString.call(a)}function b(a){return"function"==typeof a}function c(a){return"number"==typeof a}function d(a){return"string"==typeof a}function e(a){return x[a]||String.fromCharCode(a)}function f(a,b,c){for(var d in b)(c||!a.hasOwnProperty(d))&&(a[d]=b[d]);return a}function g(a,b){return function(){a.apply(b,arguments)}}function h(a){var c={};for(var d in a)c[d]=b(a[d])?g(a[d],a):a[d];return c}function i(a){function c(c){b(c)&&c.apply(a,[].splice.call(arguments,1))}function g(a){for(J=0;J<$.length;J++)M=$[J],d(M)?E[(a?"add":"remove")+"EventListener"].call(E,M,D,!1):b(M)?D=M:E=M}function i(){G(C),C=F(i),V||(c(a.setup),V=b(a.setup),c(a.resize)),a.running&&!T&&(a.dt=(L=+new Date)-a.now,a.millis+=a.dt,a.now=L,c(a.update),a.autoclear&&Y&&a.clear(),c(a.draw)),T=++T%a.interval}function j(){E=X?a.style:a.canvas,K=X?"px":"",a.fullscreen&&(a.height=u.innerHeight,a.width=u.innerWidth),E.height=a.height+K,E.width=a.width+K,a.retina&&Y&&W&&(E.height=a.height*W,E.width=a.width*W,E.style.height=a.height+"px",E.style.width=a.width+"px",a.scale(W,W)),V&&c(a.resize)}function k(a,b){return I=b.getBoundingClientRect(),a.x=a.pageX-I.left-u.scrollX,a.y=a.pageY-I.top-u.scrollY,a}function l(b,c){return k(b,a.element),c=c||{},c.ox=c.x||b.x,c.oy=c.y||b.y,c.x=b.x,c.y=b.y,c.dx=c.x-c.ox,c.dy=c.y-c.oy,c}function m(a){if(a.preventDefault(),N=h(a),N.originalEvent=a,N.touches)for(U.length=N.touches.length,J=0;J<N.touches.length;J++)U[J]=l(N.touches[J],U[J]);else U.length=0,U[0]=l(N,Z);return f(Z,U[0],!0),N}function n(b){for(b=m(b),R=(S=$.indexOf(O=b.type))-1,a.dragging=/down|start/.test(O)?!0:/up|end/.test(O)?!1:a.dragging;R;)d($[R])?c(a[$[R--]],b):d($[S])?c(a[$[S++]],b):R=0}function o(b){P=b.keyCode,Q="keyup"==b.type,_[P]=_[e(P)]=!Q,c(a[b.type],b)}function q(b){a.autopause&&("blur"==b.type?y:w)(),c(a[b.type],b)}function w(){a.now=+new Date,a.running=!0}function y(){a.running=!1}function z(){(a.running?y:w)()}function A(){Y&&a.clearRect(0,0,a.width,a.height)}function B(){H=a.element.parentNode,J=v.indexOf(a),H&&H.removeChild(a.element),~J&&v.splice(J,1),g(!1),y()}var C,D,E,H,I,J,K,L,M,N,O,P,Q,R,S,T=0,U=[],V=!1,W=u.devicePixelRatio,X=a.type==r||a.type==s,Y=a.type==p,Z={x:0,y:0,ox:0,oy:0,dx:0,dy:0},$=[a.element,n,"mousedown","touchstart",n,"mousemove","touchmove",n,"mouseup","touchend",n,"click",t,o,"keydown","keyup",u,q,"focus","blur",j,"resize"],_={};for(P in x)_[x[P]]=!1;return f(a,{touches:U,mouse:Z,keys:_,dragging:!1,running:!1,millis:0,now:0/0,dt:0/0,destroy:B,toggle:z,clear:A,start:w,stop:y}),v.push(a),a.autostart&&w(),g(!0),j(),i(),a}for(var j,k,l="E LN10 LN2 LOG2E LOG10E PI SQRT1_2 SQRT2 abs acos asin atan ceil cos exp floor log round sin sqrt tan atan2 pow max min".split(" "),m="__hasSketch",n=Math,o="http://www.w3.org/2000/svg",p="canvas",q="webgl",r="dom",s="svg",t=document,u=window,v=[],w={fullscreen:!0,autostart:!0,autoclear:!0,autopause:!0,container:t.body,interval:1,globals:!0,retina:!1,type:p},x={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"},y={CANVAS:p,WEB_GL:q,WEBGL:q,DOM:r,SVG:s,instances:v,install:function(b){if(!b[m]){for(var d=0;d<l.length;d++)b[l[d]]=n[l[d]];f(b,{TWO_PI:2*n.PI,HALF_PI:n.PI/2,QUATER_PI:n.PI/4,random:function(b,d){return a(b)?b[~~(n.random()*b.length)]:(c(d)||(d=b||1,b=0),b+n.random()*(d-b))},lerp:function(a,b,c){return a+c*(b-a)},map:function(a,b,c,d,e){return(a-b)/(c-b)*(e-d)+d}}),b[m]=!0}},create:function(a){return a=f(a||{},w),a.globals&&y.install(self),j=a.element=a.element||(a.type!=s?t.createElement(a.type==r?"div":"canvas"):t.createElementNS(o,"svg")),k=a.context=a.context||function(){switch(a.type){case p:return j.getContext("2d",a);case q:return j.getContext("webgl",a)||j.getContext("experimental-webgl",a);case r:case s:return j.canvas=j}}(),(a.container||t.body).appendChild(j),y.augment(k,a)},augment:function(a,b){return b=f(b||{},w),b.element=a.canvas||a,b.element.classList.add("sketch"),f(a,b,!0),i(a)}},z=["ms","moz","webkit","o"],A=self,B=0,C="AnimationFrame",D="request"+C,E="cancel"+C,F=A[D],G=A[E],H=0;H<z.length&&!F;H++)F=A[z[H]+"Request"+C],G=A[z[H]+"Cancel"+D];return A[D]=F=F||function(a){var b=+new Date,c=n.max(0,16-(b-B)),d=setTimeout(function(){a(b+c)},c);return B=b+c,d},A[E]=G=G||function(a){clearTimeout(a)},y}(),e=["C6","A5","G5","E5","D5","C5","A4","G4","E4","D4","C4","A3"],f=function(){function b(a,b){var c=document.createElement("div");return c.style.width=a+"px",c.style.left=b+"px",c.classList.add("bar"),c}return{create:function(){var c={interval:450,position:0,playing:!0,steps:0,queue:[],size:100,el:document.createElement("div")};c.el.classList.add("sequencer");var d=null,e=Date.now(),f=c.el.children,g=c.size;return a(c,{update:function(){if(c.playing){var a=Date.now();if(a-e>=c.interval){f[c.position]&&f[c.position].classList.remove("active"),c.position=(c.position+1)%c.steps,f[c.position]&&f[c.position].classList.add("active");for(var b,d=c.position*c.size,g=d+c.size,h=0,j=i.balls.length;j>h;h++)b=i.balls[h],b.attached&&b.el.x>d&&b.el.x<g&&(o.play(b.note,b.master?b.master.octave:4,b.el.x/s.width*2-1,b.el.y/s.height*2-1),b.el.x-=random(-5,5),b.el.y-=random(12,20));e=a}}},resize:function(){if(d=c.el.getBoundingClientRect(),c.steps=ceil(d.width/c.size),c.size!==g){for(var a,e=0,h=f.length;h>e;e++)a=f[e],a.style.width=c.size+"px",a.style.left=e*c.size+"px";g=c.size}for(;f.length>c.steps;)f[f.length-1].remove();for(;f.length<c.steps;)c.el.appendChild(b(c.size,f.length*c.size))}})}}}(),g=function(){function a(b,c,d){var e=this;e.maxDepth=b=b||4,e.maxItems=c=c||10,e.depth=d=d||0,e.hasChildren=b>d,e.hasDivided=!1,e.items=[],e.hasChildren&&(e.q1=new a(b,c,d+1),e.q2=new a(b,c,d+1),e.q3=new a(b,c,d+1),e.q4=new a(b,c,d+1))}return a.prototype={resize:function(a,b,c,d){var e=this;e.x=a,e.y=b,e.w=c,e.h=d,e.hw=e.w/2,e.hh=e.h/2,e.cx=e.x+e.hw,e.cy=e.y+e.hh,e.hasChildren&&(e.q1.resize(e.x,e.y,e.hw,e.hh),e.q2.resize(e.cx,e.y,e.hw,e.hh),e.q3.resize(e.cx,e.cy,e.hw,e.hh),e.q4.resize(e.x,e.cy,e.hw,e.hh))},locate:function(a){var b=this;if(b.hasChildren){if(a.y+a.radius<b.cy){if(a.x+a.radius<b.cx)return b.q1;if(a.x-a.radius>b.cx)return b.q2}if(a.y-a.radius>b.cy){if(a.x-a.radius>b.cx)return b.q3;if(a.x+a.radius<b.cx)return b.q4}}},insert:function(a){var b,c,d=this;if(d.hasDivided&&(b=this.locate(a)))return b.insert(a),void 0;if(d.items.push(a),d.items.length>=d.maxItems&&d.depth<d.maxDepth)for(d.hasDivided=!0,c=d.items.length-1;c>=0;--c)a=d.items[c],b=this.locate(a),b&&(d.items.splice(c,1),b.insert(a))},update:function(a){this.clear();for(var b=0,c=a.length;c>b;b++)this.insert(a[b])},search:function(a,b){b=b||[];var c,d,e=this;if(e.hasDivided){var f=e.locate(a);f&&f.search(a,b)}for(c=0,d=e.items.length;d>c;c++)b.push(e.items[c]);return b},clear:function(){var a=this;a.hasDivided=!1,a.items.length=0,a.hasChildren&&(a.q1.clear(),a.q2.clear(),a.q3.clear(),a.q4.clear())},draw:function(a){var b=this;a.strokeStyle="#ff00ff",a.strokeRect(b.x,b.y,b.w,b.h),b.hasChildren&&b.hasDivided&&(b.q1.draw(a),b.q2.draw(a),b.q3.draw(a),b.q4.draw(a))}},a}(),h=function(){"use strict";function a(a,b,c){for(var d in b)!c&&d in a||(a[d]=b[d]);return a}function b(a,b){var c=b.indexOf(a);~c&&b.splice(c,1)}var c="You must provide a and b particles",d="particle",e="spring",f="pin",h=2*Math.PI,i=1e-10,j=Math.sqrt,k=Math.pow,l=window,m={useQuadtree:!0,collisions:!0,timestep:1/60,maxSteps:10,friction:.05,gravity:3e3,walls:!0,wind:0};return{create:function(n){var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q=a(n||{},m),R=new g,S=0,T=[],U=[],V=[],W={minX:0,minY:0,maxX:l.innerWidth,maxY:l.innerHeight};return a(Q,{particles:T,quadtree:R,springs:U,clock:0,bounds:function(b){W=a(b||{},W),R.resize(W.minX,W.minY,W.maxX-W.minX,W.maxY-W.minY)},particle:function(b){return b=b||{},a(b,{type:d,colliding:!1,collide:!0,enabled:!0,radius:10,fixed:!1,mass:1,fx:0,fy:0,vx:0,vy:0,x:0,y:0}),b.id=T.length,T.push(b),b},spring:function(b){if(b=b||{},!b.a||!b.b)throw c;return a(b,{type:e,restLength:100,stiffness:1,enabled:!0,tension:0,length:0}),U.push(b),b},pin:function(b){if(b=b||{},!b.a||!b.b)throw c;return a(b,{type:f,enabled:!0,easing:1}),V.push(b),b},update:function(a){if(a=a||Date.now(),C=a-(Q.clock||a),Q.clock=a,0!==C)for(S+=C*=.001,q=1-Q.friction,s=0,u=k(Q.timestep,2),o=Q.collisions,t=Q.walls,F=Q.gravity,P=Q.wind;S>Q.timestep&&!(s++>=Q.maxSteps);){for(S-=Q.timestep,p=0,L=0,I=T.length;I>L;L++)N=T[L],N.enabled&&(N.colliding=!1,N.fixed||(N.collide&&p++,N.ox=N.ox||N.x,N.oy=N.oy||N.y,N.vx=(N.x-N.ox)*q+N.fx/N.mass+P*u,N.vy=(N.y-N.oy)*q+N.fy/N.mass+F*u,N.ox=N.x,N.oy=N.y,N.x+=N.vx,N.y+=N.vy,N.fx=N.fy=0));for(L=0,I=U.length;I>L;L++)G=U[L],G.enabled&&(E=G.a,D=G.b,x=D.x-E.x,w=D.y-E.y,J=G.length=j(x*x+w*w)||i,K=(J-G.restLength)/(J*(E.mass+D.mass))*G.stiffness,G.tension=K,E.fixed||D.fixed||(K*=.5),E.fixed||(O=K/E.mass,E.x+=x*O,E.y+=w*O),D.fixed||(O=K/D.mass,D.x-=x*O,D.y-=w*O));if(p>0)for(o&&Q.useQuadtree&&R.update(T),L=0,I=T.length;I>L;L++)if(E=T[L],t&&(E.x-E.radius<W.minX?E.x=W.minX+E.radius:E.x+E.radius>W.maxX&&(E.x=W.maxX-E.radius),E.y-E.radius<W.minY?E.y=W.minY+E.radius:E.y+E.radius>W.maxY&&(E.y=W.maxY-E.radius)),o&&E.collide)for(Q.useQuadtree?(r=R.search(E),H=0):(r=T,H=L+1),O=r.length;O>H;H++)D=r[H],D!==E&&D.collide&&(x=D.x-E.x,w=D.y-E.y,y=x*x+w*w||i,v=E.radius+D.radius,v*v>y&&(E.colliding=!0,D.colliding=!0,J=j(y),M=v-J,M/=v,B=1/(E.mass+D.mass),A=E.mass*B*M,z=D.mass*B*M,E.fixed||(E.x-=x*A,E.y-=w*A),D.fixed||(D.x+=x*z,D.y+=w*z)));for(L=0,I=V.length;I>L;L++)N=V[L],N.enabled&&(E=N.a,D=N.b,N.easing<1?(D.x+=(E.x-D.x)*N.easing,D.y+=(E.y-D.y)*N.easing,D.ox=D.x,D.oy=D.y):(D.x=D.ox=E.x,D.y=D.oy=E.y))}},kill:function(a){switch(a.type){case d:b(a,T);break;case e:b(a,U);break;case f:b(a,V)}},draw:function(a){var b,c,d,e;for(a.strokeStyle="#000",a.globalAlpha=1,a.lineWidth=2,b=0,d=T.length;d>b;b++)c=T[b],a.beginPath(),a.arc(c.x,c.y,c.radius,0,h),a.stroke(),c.colliding&&(a.globalAlpha=.5,a.fill(),a.globalAlpha=1);for(a.globalAlpha=.8,a.lineWidth=.5,b=0,d=U.length;d>b;b++)e=U[b],a.beginPath(),a.moveTo(e.a.x,e.a.y),a.lineTo(e.b.x,e.b.y),a.stroke();R.draw(a)}})}}}(),i=function(){function b(){E.el=r.group(),E.el.addClass("scene"),chainLayer=r.group(),ballLayer=r.group(),E.el.add(chainLayer),E.el.add(ballLayer),c()}function c(){var a=(window.top.location.hash||window.location.hash).replace(/^#/,""),b=C;if(a)try{b=JSON.parse(a)}catch(c){}if(b)try{B(b)}catch(c){d(),B(C)}}function d(){for(;chainLayer.children.length;)chainLayer.children[0].remove();for(;F.length;)F.pop().destroy();for(;ballLayer.children.length;)ballLayer.children[0].remove();for(;G.length;)G.pop().destroy()}function f(a,b){b?(a.el.addClass(b.note),a.el.addClass("small"),b.chain=a,a.ball=b,a.setB(b.el)):(a.getA().addEventListener("mousedown",w),a.getB().addEventListener("mousedown",w),a.el.addEventListener("mouseup",x),a.el.addClass("octave-"+a.octave),a.el.addClass("droppable"),a.el.addClass("large"),a.getA().classList.add("draggable"),a.getB().classList.add("draggable")),chainLayer.add(a.el),F.push(a)}function g(a){a.el.removeEventListener("mouseup",x),F.splice(F.indexOf(a),1),a.el.remove()}function h(a){a.el.addEventListener("mousedown",u),a.el.addEventListener("mouseup",v),a.el.addClass("draggable"),ballLayer.add(a.el),G.push(a)}function i(b){if(b){if(b.type===l.TYPE){var c=b;if(H.target=c,H.on=!0,c.attached)H.handle=c.el,c.el.fixed=!0;else{var d=a({},D[0]),e=k.create(a(d,{restLength:80,startX:c.el.x,startY:c.el.y}));f(e,c),H.handle=e.getA(),e.getA().fixed=!0}}else b.chain&&(H.target=b.chain,H.handle=b,H.on=!0);document.addEventListener("mousemove",y),document.addEventListener("mouseup",z),document.body.classList.add("dragging"),b.classList&&b.classList.add("dragging")}}function j(){H.handle&&H.handle.classList&&H.handle.removeClass("dragging"),H.target=null,H.handle=null,H.on=!1}function m(a,b,c){c=c||b.nearestPoint(a.chain.getA()),chainLayer.insertBefore(a.chain.el,b.el),b.setRestLength(.75*b.restLength),a.attached=!0,a.chain.setA(c),a.master=b}function o(a,b){b.chain.setA(a.el),b.attached=!0,b.master=a.master}function q(a){a.attached&&(g(a.chain),a.chain.destroy(),a.chain=null,a.attached=!1,a.el.fixed=!1)}function t(){if(H.on&&(H.handle.x=s.mouse.x,H.handle.y=s.mouse.y,H.handle.ox+=.3*(s.mouse.x-H.handle.ox),H.handle.oy+=.3*(s.mouse.y-H.handle.oy),H.target.type===l.TYPE)){var a=H.target;a.attached&&a.chain.getLength()>3.5*a.chain.restLength&&(q(a),j())}}function u(a){i(a.target.ball)}function v(a){var b=a.target.ball;if(b&&H.on&&H.target.type===l.TYPE){var c=H.target;c!==b&&o(b,c)}}function w(a){i(a.target)}function x(a){var b=a.target.chain;if(H.on&&H.target.type===l.TYPE){var c=H.target;c.attached||m(c,b)}}function y(){}function z(){if(H.on&&H.target.type===l.TYPE){var a=H.target;a.attached?a.el.fixed=!1:(g(a.chain),a.chain.destroy(),a.chain=null)}document.removeEventListener("mousemove",y),document.body.classList.remove("dragging"),j()}function A(){var a,b,c,d,f,g,h=[],i=[],j=[p.interval,p.size],k=[];for(c=0,d=F.length;d>c;c++)g=F[c],a=g.getA(),b=g.getB(),i.push([G.indexOf(g.ball),round(a.x),round(a.y),round(b.x),round(b.y),round(g.restLength),g.octave]);for(c=0,d=G.length;d>c;c++)if(f=G[c],h.push([round(f.el.x),round(f.el.y),round(f.el.radius),e.indexOf(f.note)]),f.attached){var l=[~~!!f.chain.getA().chain];l[1]=c,l[2]=F.indexOf(f.chain),l[0]?(l[3]=F.indexOf(f.chain.getA().chain),l[4]=f.chain.getA().index):l[3]=G.indexOf(f.chain.getA().ball),k.push(l)}var l=[j,h,i,k];return JSON.stringify(l)}function B(b){d(),b="string"==typeof b?JSON.parse(b):b;var c=b[0],g=b[1],i=b[2],j=b[3];p.interval=c[0],p.size=c[1],p.resize(),n.refresh();var q,r,s;for(q=0,r=g.length;r>q;q++)s=g[q],h(l.create({radius:s[2],note:e[s[3]],x:s[0],y:s[1]}));for(q=0,r=i.length;r>q;q++){s=i[q];var t=a({},D[-1===s[0]?1:0]),u=k.create(a(t,{restLength:s[5],octave:s[6],startX:s[1],startY:s[2],endX:s[3],endY:s[4]}));-1===s[0]&&(u.getA().fixed=!0,u.getB().fixed=!0),f(u,G[s[0]])}for(q=0,r=j.length;r>q;q++){s=j[q];var v=G[s[1]];if(v.chain=F[s[2]],v.chain.setB(v.el),s[0]){var u=F[s[3]];m(v,u,u.points[s[4]])}else o(G[s[3]],v)}}var C=[[450,100],[[690,516,27,0],[804,780,26,1],[266,144,20,2],[325,272,29,3],[1151,190,25,4],[193,518,22,5],[172,371,29,6],[347,467,21,7],[934,374,26,8],[121,319,23,9],[859,777,29,10],[322,190,29,11],[657,324,27,0],[529,778,28,1],[753,781,25,2],[898,486,25,3],[238,614,20,4],[384,485,20,5],[905,661,20,6],[934,292,27,7],[508,643,29,8],[237,532,25,9],[787,716,22,10],[1e3,608,27,11],[1161,785,21,0],[1047,339,21,1],[1187,154,24,2],[224,442,29,3],[302,780,26,4],[715,314,29,5],[548,285,29,6],[587,776,30,7],[696,722,28,8],[299,463,27,9],[974,424,24,10],[848,487,23,11],[633,708,28,0],[414,784,22,1],[1030,782,24,2],[994,691,24,3],[924,425,26,4],[900,578,20,5],[459,785,21,6],[43,782,24,7],[661,407,21,8],[828,305,24,9],[532,515,22,10],[914,780,26,11]],[[-1,228,32,1283,17,0,3],[-1,87,196,1073,239,0,4],[-1,455,517,1057,466,1,5],[6,173,288,172,371,80,4],[27,225,335,224,442,80,4],[32,698,639,696,722,80,4],[30,545,202,548,285,80,4],[12,657,231,657,324,80,4],[21,224,442,237,532,80,4],[36,635,625,633,708,80,4],[2,265,62,266,144,80,4],[22,792,633,787,716,80,4],[46,536,433,532,515,80,4],[44,657,324,661,407,80,4],[19,933,203,934,292,80,4],[45,823,224,828,305,80,4],[23,1013,515,1e3,608,80,4],[35,846,404,848,487,80,4],[15,898,385,898,486,80,4],[20,508,560,508,643,80,4],[33,328,387,299,463,80,4],[29,713,231,715,314,80,4],[8,934,292,934,374,80,4],[39,1e3,608,994,691,80,4],[41,898,486,900,578,80,4],[34,950,347,974,424,80,4],[5,224,442,193,518,80,4],[11,322,99,322,190,80,4],[16,237,532,238,614,80,4],[0,691,434,690,516,80,4],[17,380,403,384,485,80,4],[7,328,387,347,467,80,4],[18,900,578,905,661,80,4],[40,950,347,924,425,80,4],[25,1056,257,1047,339,80,4],[9,121,236,121,319,80,4],[3,322,190,325,272,80,4],[26,1207,73,1187,154,80,4],[4,1152,108,1151,190,80,4]],[[1,0,29,1,12],[1,2,10,0,1],[0,3,36,11],[1,4,38,0,17],[0,5,26,27],[1,6,3,1,2],[1,7,31,1,5],[0,8,22,19],[1,9,35,1,1],[1,11,27,0,2],[1,12,7,0,8],[1,15,18,1,16],[0,16,28,21],[1,17,30,1,6],[0,18,32,41],[1,19,14,0,13],[1,20,19,2,2],[0,21,8,27],[1,22,11,2,11],[1,23,16,2,18],[1,25,34,1,19],[1,26,37,0,18],[1,27,4,1,3],[1,29,21,0,9],[1,30,6,0,6],[1,32,5,2,8],[1,33,20,1,5],[1,34,25,1,17],[1,35,17,1,15],[1,36,9,2,6],[0,39,23,23],[1,40,33,1,17],[0,41,24,15],[0,44,13,12],[1,45,15,0,11],[1,46,12,1,9]]],D={0:{type:0,minRadius:0,maxRadius:7,segments:2},1:{type:1,minRadius:5,maxRadius:10,segments:20}},E={},F=[],G=[],H={target:null,handle:null,on:!1};return a(E,{chains:F,balls:G,init:b,update:t,serialise:A,deserialise:B,detachBall:q})}(),j=function(){var a={C:60,"C#":61,D:62,"D#":63,E:64,F:65,"F#":66,G:67,"G#":68,A:69,"A#":70,B:71};return{create:function(){function b(){return f.master=c.createGain(),f.master.gain.value=.5,f.delay=c.createDelay(),f.delay.delayTime.value=.25,f.delay.connect(f.master),f.master.connect(f.delay),f.master.connect(c.destination),f}var d=a.A,e=4,f={sustain:1,release:20,attack:0,decay:20};return f.play=function(a,b,d,e,g){d=d||0,e=e||0,g=g||0;var h=f.noteToFreq(a,b),i=c.createOscillator(),j=c.createGain(),k=c.createPanner();k.setPosition(d,e,g),i.connect(j),j.connect(k),k.connect(o.master),i.type=i.SINE,i.frequency.setValueAtTime(h,0);var l=c.currentTime,m=l+f.attack/10,n=f.sustain/100,p=f.decay/100;j.gain.setValueAtTime(0,l),j.gain.linearRampToValueAtTime(1,m),j.gain.setTargetAtTime(n,m,p+.001),i.start(0),m=l+f.release/10,j.gain.cancelScheduledValues(l),j.gain.setValueAtTime(j.gain.value,l),j.gain.setTargetAtTime(0,l,f.release/100),i.stop(m)},f.noteToFreq=function(b,c){null==c&&(c=e);var f=b.match(/\d+/)[0],g=b.match(/[A-Z\#]+/i)[0],h=f-c,i=a[g]-d,j=i+12*h;return 440*Math.pow(2,j/12)},b()}}}(),k=function(){var c={restLength:100,segments:10,stiffness:1,minRadius:5,maxRadius:10,octave:4,startX:0,startY:0};return{create:function(d){function e(){j.curve=r.spline({points:n,chain:j}),j.curve.addClass("curve"),o.add(j.curve);for(var a,b=f(j.startX,j.startY,0),c=j.restLength/j.segments-1,d=0;d<j.segments;d++)a=f(lerp(j.startX,j.endX,d/j.segments),lerp(j.startY,j.endY,d/j.segments),d+1),m.push(q.spring({restLength:c,stiffness:j.stiffness,a:b,b:a})),b=a;k=j.getA(),l=j.getB()}function f(a,b,c){var d=1>c||c>j.segments-1,e=r.ellipse({collide:!1,radius:d?j.maxRadius:j.minRadius,chain:j,index:c,x:a,y:b});return d&&e.addClass("end"),e.addClass("point"),q.particle(e),n.push(e),o.add(e),e}function g(a){j.restLength=a;for(var b=0,c=a/j.segments-1,d=m.length;d>b;b++)m[b].restLength=c}function h(a){for(var c=n.concat(),d=0,e=n.length;e>d;d++)n[d].distanceSq=b(n[d],a);return c.sort(function(a,b){return a.distanceSq-b.distanceSq}),c[0]}function i(){for(j.setA(null),j.setB(null);o.children.length;)o.children[0].remove();for(;m.length;)q.kill(m.pop());for(;n.length;)q.kill(n.pop())}var j={};d=a(d||{},c),d.endX=d.endX||d.startX,d.endY=d.endY||d.startY,a(j,d);var k,l,m=[],n=[],o=r.group();return o.addClass("chain"),a(j,{springs:m,points:n,el:o,destroy:i,setRestLength:g,nearestPoint:h,getLength:function(){for(var a=0,b=0,c=m.length;c>b;b++)a+=m[b].length;return a},getA:function(){return m[0].a},setA:function(a){var b=0;a?(k.enabled=!1,k.remove(),m[b].a=a,n[b]=a):(k.x=k.ox=m[b].a.x,k.y=k.oy=m[b].a.y,m[b].a=k,n[b]=k,k.enabled=!0,o.add(k))},getB:function(){return m[j.segments-1].b},setB:function(a){var b=j.segments-1;a?(l.enabled=!1,l.remove(),m[b].b=a,n[b+1]=a):(l.x=l.ox=m[b].a.x,l.y=l.oy=m[b].a.y,m[b].b=l,n[b+1]=l,l.enabled=!0,o.add(l))}}),e(),j}}}(),l=function(){var b,c="ball",d={radius:20,x:0,y:0};return{TYPE:c,create:function(f){function g(){b||(b=r.def(r.path({id:"shading",d:"M16,34c-27.614,0-50-22.386-50-50c0-9.709,2.776-18.765,7.564-26.436C-40.582-33.604-50-17.905-50,0 c0,27.614,22.386,50,50,50c17.905,0,33.604-9.418,42.436-23.565C34.765,31.224,25.708,34,16,34z"}))),j.ball=i,j.addClass("ball"),j.addClass(i.note),j.radius=i.radius,j.x=i.x,j.y=i.y,i.shape=r.ellipse({radius:j.radius,ball:i}),i.shading=r.use(b,{scale:2*j.radius/100,fixed:!0}),i.shape.addClass("shape"),i.shading.addClass("shading"),j.add(i.shape),j.add(i.shading),q.particle(j)}function h(){for(;j.children.length;)j.children[0].remove();q.kill(i.el)}var i={type:c,attached:!1};f=a(f||{},d),f.note=f.note||random(e),a(i,f);var j=r.group();return a(i,{destroy:h,el:j}),g(),i}}}(),m=function(){"use strict";function a(a,b,c){for(var d in b)!c&&d in a||(a[d]=b[d]);return a}function b(a,b){for(var d in b)d in a?c(a,d,b[d]):a[d]=b[d]}function c(a,b,c){var d="_"+b;a[d]=c,Object.defineProperty(a,b,{get:function(){return a[d]},set:function(b){a[d]=b}})}function d(a){return a.replace(/(\w)([A-Z])/g,function(a,b,c){return b+"-"+c.toLowerCase()})}function e(a){for(var b,c,d,e,f,g,h,i,j,k,l,m,n="M"+a[0].x+","+a[0].y,o=1/6,p=0,q=a.length-2;q>=p;p++)0===p?(b=a[p],c=a[p+1],d=a[p+2],f=b.x,j=b.y,h=c.x,l=c.y,i=d.x,m=d.y,g=f,k=j):p===q?(b=a[p-1],c=a[p],d=a[p+1],f=b.x,j=b.y,g=c.x,k=c.y,h=d.x,l=d.y,i=h,m=l):(b=a[p-1],c=a[p],d=a[p+1],e=a[p+2],f=b.x,j=b.y,g=c.x,k=c.y,h=d.x,l=d.y,i=e.x,m=e.y),f=(-f+6*g+h)*o,j=(-j+6*k+l)*o,g=(g+6*h-i)*o,k=(k+6*l-m)*o,n+="C"+f+","+j+" "+g+","+k+" "+h+","+l+" ";return n}function f(c,e,f){var h,k,l,m,n,o,p=document.createElementNS(g,c),q=f||p,r=p.getCTM()||q.createSVGMatrix(),s=q.createSVGTransform();return e=e||{},b(p,{scale:e.scale||1,x:e.x||0,y:e.y||0}),a(a(p,e),{rotation:0,on:function(a,b,c){p.addEventListener(a,b,c)},off:function(a,b,c){p.removeEventListener(a,b,c)},attr:function(a,b){if("object"==typeof a)for(var c in a)a.hasOwnProperty(c)&&p.attr(c,a[c]);else if("string"==typeof a)if(i.test(typeof b))p.setAttribute(d(a),b);else if(null!=a)return p.getAttribute(d(a));return p},addClass:function(a){return p.classList.add(a),p},removeClass:function(a){return p.classList.remove(a),p},add:function(){for(var a=[].splice.call(arguments,0),b=0,c=a.length;c>b;b++)p.appendChild(a[b]);return p},render:function(){var a,b=p.children;p!==q&&(p.hasOwnProperty("update")&&p.update(),p.hasOwnProperty("draw")&&p.draw(),(p.x!==h||p.y!==k||p.rotation!==l||p.scale!==m||p.scaleX!==n||p.scaleY!==o)&&(r.a=p.scaleX||p.scale,r.d=p.scaleY||p.scale,r.e=p.x,r.f=p.y,s.setMatrix(r.rotate(p.rotation*j)),p.transform.baseVal.initialize(s),l=p.rotation,n=p.scaleX,o=p.scaleY,m=p.scale,h=p.x,k=p.y));for(var c=0,d=b.length;d>c;c++)a=b[c],a.hasOwnProperty("render")&&a.render();return p}}),p.attr(e),p}var g="http://www.w3.org/2000/svg",h="http://www.w3.org/1999/xlink",i=/number|string/,j=180/Math.PI;return{create:function(){var b,c=f("svg");return a(c,{create:function(a,b){return f(a,b||{},c)},def:function(a){return b||(b=document.createElementNS(g,"defs"),c.add(b)),b.appendChild(a),a},use:function(a,b){var d=f("use",b,c);return d.setAttributeNS(h,"href","#"+("string"==typeof a?a:a.id)),d},group:function(a){return f("g",a||{},c)},path:function(b){return f("path",a(b||{},{draw:function(){var a=this;if(a.points&&a.points.length){for(var b,c=0,d=a.points.length,e="";d>c;c++)e+=(c?"L":"M")+(b=a.points[c]).x+" "+b.y+" ";a.closed&&(e+="z"),a.attr("d",e)}return a}}),c)},spline:function(b){return f("path",a(b||{},{draw:function(){var a=this;if(a.points&&a.points.length>2){var b=e(a.points);a.closed&&(b+="z"),a.attr("d",b)}return a}}),c)},ellipse:function(b){return f("ellipse",a(b||{},{draw:function(){var a=this;"number"==typeof a.radius&&a.attr("rx",a.radius).attr("ry",a.radius)}}),c)}})}}}(),n=function(){function a(){h=document.querySelector(".ui"),h.classList.remove("hidden"),c=document.querySelector("button.toggle"),d=document.querySelector("button.clear"),e=document.querySelector("button.save"),f=document.querySelector(".slider.tempo"),g=document.querySelector(".slider.size"),d.addEventListener("click",function(){for(var a,b=i.balls,c=0,d=b.length;d>c;c++)a=b[c],a.attached&&i.detachBall(a)}),c.addEventListener("click",function(){p.playing=!p.playing,c.innerText=p.playing?"Pause":"Play",c.classList[p.playing?"add":"remove"]("playing")}),e.addEventListener("click",function(){window.location.hash=window.top.location.hash=i.serialise()}),f.addEventListener("change",function(){p.interval=map(f.value,0,1,j,k)}),g.addEventListener("change",function(){p.size=map(g.value,0,1,l,m),p.resize()}),b()}function b(){f.value=map(p.interval,j,k,0,1),g.value=map(p.size,l,m,0,1)}var c,d,e,f,g,h,j=550,k=200,l=30,m=200;return{refresh:b,init:a}}();if("undefined"!=typeof AudioContext?c=new AudioContext:"undefined"!=typeof webkitAudioContext&&(c=new webkitAudioContext),c&&c.createOscillator){var o=j.create(),p=f.create(),q=h.create(),r=m.create(),s=d.create({container:document.querySelector("#container"),type:d.DOM});s.setup=function(){this.appendChild(p.el),this.appendChild(r),n.init(),i.init(),q.friction=.02,q.gravity=2500,r.classList.add("canvas"),r.add(i.el)},s.draw=function(){q.update(),i.update(),p.update(),r.render()},s.resize=function(){p.resize(),q.bounds({maxY:this.height,maxX:this.width}),r.attr({height:this.height,width:this.width})},s.focus=function(){q.clock=Date.now()}}else{var t=document.querySelector(".error");t.style.display="block"}}();